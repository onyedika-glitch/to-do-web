function n(e){return document.querySelector(e)}const d="/api/todos",a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");function c(e){Swal.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,icon:"success",title:e})}function i(e){Swal.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:2500,icon:"error",title:e})}async function r(){try{const t=await(await fetch(d)).json();h(t)}catch{i("Failed to load todos")}}function m(e){const t=document.createElement("div");return t.className="p-4 bg-white border rounded flex items-start justify-between",t.dataset.id=e.id,t.innerHTML=`
    <div>
      <label class="flex items-center gap-3">
        <input type="checkbox" class="toggle" ${e.completed?"checked":""}/>
        <div>
          <div class="font-medium ${e.completed?"line-through text-gray-400":""}">${s(e.title)}</div>
          <div class="text-sm text-gray-500">${s(e.description||"")}</div>
          <div class="text-xs text-gray-400 mt-1">${new Date(e.created_at).toLocaleString()}</div>
        </div>
      </label>
    </div>
    <div class="flex gap-2 items-center ml-4">
      <button class="edit btn-secondary">Edit</button>
      <button class="delete btn-danger">Delete</button>
    </div>
  `,t.querySelector(".delete").addEventListener("click",()=>y(e.id)),t.querySelector(".edit").addEventListener("click",()=>T(e)),t.querySelector(".toggle").addEventListener("change",o=>g(e.id,o.target.checked)),t}function h(e){const t=n("#todos");if(t.innerHTML="",e.length===0){t.innerHTML='<div class="p-4 text-gray-500">No tasks yet. Add one!</div>';return}e.forEach(o=>t.appendChild(m(o)))}function s(e){return String(e).replace(/[&<>\"']/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]})}async function v(e,t){try{if(!(await fetch(d,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({title:e,description:t})})).ok)throw new Error("Create failed");c("Task added"),r()}catch{i("Failed to add task")}}async function u(e,t){try{if(!(await fetch(`${d}/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify(t)})).ok)throw new Error("Update failed");c("Task updated"),r()}catch{i("Failed to update")}}async function y(e){const{isConfirmed:t}=await Swal.fire({title:"Delete task?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Delete"});if(t)try{if(!(await fetch(`${d}/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":a}})).ok)throw new Error("Delete failed");c("Task deleted"),r()}catch{i("Failed to delete")}}async function g(e,t){await u(e,{completed:t})}function T(e){n("#modal").classList.remove("hidden"),n("#modal").classList.add("flex"),n("#edit-id").value=e.id,n("#edit-title").value=e.title,n("#edit-description").value=e.description||"",n("#edit-completed").checked=!!e.completed}function l(){n("#modal").classList.add("hidden"),n("#modal").classList.remove("flex")}document.addEventListener("DOMContentLoaded",()=>{r(),n("#create-form").addEventListener("submit",e=>{e.preventDefault();const t=n("#title").value.trim(),o=n("#description").value.trim();if(!t)return i("Title required");v(t,o),n("#create-form").reset()}),n("#cancel-edit").addEventListener("click",e=>{e.preventDefault(),l()}),n("#edit-form").addEventListener("submit",e=>{e.preventDefault();const t=n("#edit-id").value,o=n("#edit-title").value.trim(),f=n("#edit-description").value.trim(),p=n("#edit-completed").checked;if(!o)return i("Title required");u(t,{title:o,description:f,completed:p}),l()})});
